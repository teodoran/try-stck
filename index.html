<!DOCTYPE html>
<html lang="en">
	<!--
		Code is borrowed and modified from WebREPL by Torbjørn Marø
		Huge thanks to him!
		https://github.com/tormaroe/webrepl
		http://blog.kjempekjekt.com/2013/02/22/webrepl-en-javascript-basert-kommandolinje/
	-->
	<title>Try STCK</title>
	<link rel="stylesheet" type="text/css" href="webrepl.css">

	<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.1.min.js" type="text/javascript" language="javascript"></script>
	<script type='text/javascript' src='node_modules/fable-core/fable-core.min.js'></script>
    <script type='text/javascript' src='stck.js'></script>
	<script type="text/javascript" src="webrepl.js"></script>
	
	<!--<div><img src="logo.png"></div>-->
	
	<div id="container" style="margin-left:20px;"></div>

	<script type="text/javascript">
	$(document).ready(function () {
		var heapStack = stck.startHeapAndStack();

		var displayError = function (err) {
			return '<dt style="color:red;">' + err + "</dt>"
		};

		var sprint = function (stack) {
			return '<dt style="color:yellow;">' + stack[1].ToString() + "</dt>"
		};

		var displayHeapElement = function (element) {
			return '<dt style="color:yellow;">' + element[0] + ' -> ' + element[1].ToString() + "</dt>"
		};

		var hprint = function (heap) {
			if (!heap.head) {
				return "";
			}
			return displayHeapElement(heap.head) + hprint(heap.tail);
		};

		var terminal = webrepl.make({ 
			container: $('#container'),
			prompt: '$&gt; ',
			state: { 
				memory: {} 
			},
			welcome: 'Welcome to <strong>STCK</strong> 1.1, a stack-based programming language in the browser',
			commandHandler: function (input, state) {
				if (input === 'help') {
					window.open('https://github.com/teodoran/stck/blob/master/README.md#using-the-languague','_blank');
					return ''
				}
				if (input === 'hprint') {
					return hprint(heapStack[0]);
				}
				if (input === 'sprint') {
					return sprint(heapStack);
				}

				heapStack = stck.evalPrint(heapStack[0], heapStack[1], input);

				if (stck.error) {
					var e = stck.error;
					stck.error = null;
					return displayError(e);
				} else {
					return sprint(heapStack);
				}
			}
		});
	});
	</script>
</html>